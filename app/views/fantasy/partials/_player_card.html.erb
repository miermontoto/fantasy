<%# Unified Player Card %>
<div class="flex items-center <%= player.own ? 'bg-gray-600' : 'bg-gray-700' %> rounded-lg p-2 hover:bg-gray-600 transition-colors w-full">
  <div class="relative flex-shrink-0">
    <img class="w-12 h-12 rounded-lg" src="<%= player.player_img %>" alt="<%= player.name %>" loading="lazy">
    <% if player.status.present? %>
      <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-xs font-bold
        <%= case player.status
            when 'injury' then 'bg-red-500'
            when 'doubt' then 'bg-yellow-500'
            when 'red' then 'bg-red-500'
            else ''
            end %>">
        <%= case player.status
            when 'injury' then '+'
            when 'doubt' then '?'
            when 'red' then '◼'
            else ''
            end %>
      </div>
    <% end %>
  </div>

  <div class="flex flex-col items-center mx-2 flex-shrink-0 border-l border-r border-gray-600 px-2">
    <img src="<%= player.team_img %>" alt="Team" class="w-6 h-6 mb-1">
    <div class="<%= player.position.browser[:color] %> border-2 border-black skew-x-[-10deg] px-2 py-0.5 rounded">
      <span class="block skew-x-[10deg] text-xs font-bold text-black"><%= player.position.browser[:position] %></span>
    </div>
  </div>

  <div class="flex-1 flex items-center justify-between min-w-0">
    <div class="min-w-0 flex-shrink">
      <div class="flex items-center gap-2">
        <h3 class="font-semibold truncate"><%= player.name %></h3>
        <% if player.is_in_team && player.being_sold %>
          <span class="text-xs font-medium px-2 py-0.5 rounded bg-orange-500 text-black">En venta</span>
        <% end %>
        <% if player.own && player.being_sold %>
          <span class="text-xs font-medium px-2 py-0.5 rounded bg-orange-500 text-black">Vendiendo</span>
        <% end %>
      </div>
      <div class="flex items-center gap-2 text-xs text-gray-400">
        <% if player.is_offer %>
          <% if player.offered_by.present? && player.offered_by != ApplicationHelper::FREE_AGENT %>
            <span class="truncate"><%= player.offered_by %></span>
          <% elsif player.own %>
            <span class="text-blue-400 whitespace-nowrap">Tu jugador</span>
          <% elsif player.instance_variable_get(:@user).present? %>
            <span class="truncate"><%= player.instance_variable_get(:@user) %></span>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="flex items-center gap-4 flex-shrink-0">
      <div class="flex items-center gap-3 border-l border-r border-gray-600 px-3">
        <div class="text-center w-12">
          <div class="text-sm font-semibold"><%= player.points %></div>
          <div class="text-xs text-gray-400">PTS</div>
        </div>
        <div class="text-center w-12">
          <div class="text-sm font-semibold"><%= player.average %></div>
          <div class="text-xs text-gray-400">AVG</div>
        </div>
        <div class="text-center w-12 hidden md:block">
          <div class="text-sm font-semibold"><%= player.ppm %></div>
          <div class="text-xs text-gray-400">PPM</div>
        </div>
      </div>

      <div class="flex items-center gap-4">
        <div class="hidden sm:flex items-center gap-1">
          <% player.streak.each do |points| %>
            <% points_value = points == "-" ? 0 : points.to_i %>
            <% bg_color = if points_value < 0
                 'bg-red-500'
               elsif points_value >= 10
                 'bg-cyan-500'
               elsif points_value >= 5
                 'bg-green-500'
               elsif points_value >= 1
                 'bg-yellow-500'
               else
                 'bg-gray-500'
               end %>
            <div class="<%= bg_color %> w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold">
              <%= points %>
            </div>
          <% end %>
        </div>

        <div class="hidden sm:block border-l border-gray-600 h-8"></div>

        <div class="text-right min-w-[100px]">
          <div class="flex items-center gap-1 justify-end">
            <p class="font-bold whitespace-nowrap">
              <%= player.is_offer ? player.price : format_value(player.value) %>
            </p>
            <% if player.trend.present? %>
              <span class="text-2xl <%= player.trend.to_s.include?('↑') || player.trend.to_s.include?('up') ? 'text-green-500' : 'text-red-500' %>">
                <%= player.trend.to_s.include?('↑') || player.trend.to_s.include?('up') ? '↑' : '↓' %>
              </span>
            <% end %>
          </div>
          <%# Market-specific price difference %>
          <% if player.is_offer && player.instance_variable_get(:@diff) %>
            <p class="text-xs text-gray-400">
              <%= player.instance_variable_get(:@diff) > 0 ? '+' : '' %><%= number_to_currency(player.instance_variable_get(:@diff), unit: '€', precision: 0) %>
            </p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
